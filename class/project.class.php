<?php class Project{        public static function getAll(){                global $bdd;                $p = array();                $sql = "SELECT id_project AS id FROM projects ORDER BY id_project DESC";        $q = $bdd->query($sql);        while($r = $q->fetchObject()){            $p[] = Project::get($r->id);        }                return $p;            }                public static function get($id_proj){                global $bdd, $INTERFACE;                if(!is_numeric($id_proj)) return NULL;                $sql = "SELECT id_project AS id, title, shortener, website, description, image FROM projects WHERE id_project = ".$id_proj;        $q = $bdd->query($sql);        $proj = $q->fetchObject();                $date           = new DateTime($proj->date_creation);        $proj->title= stripslashes($proj->title);        $proj->description= stripslashes($proj->description);        $proj->url      = 'projet/'.$proj->shortener.'/';$proj->image_url= ('ADMIN'==$INTERFACE ? '../':'').'uploads/projects/'.$proj->image;        $proj->details = array();$sql = "SELECT id_detail AS id FROM projects_details WHERE id_project = ".$proj->id;        $q = $bdd->query($sql);        while($r = $q->fetchObject()){            $proj->details[] = Project::getDetail($r->id);        }        return $proj;            }        public static function getViaUrl($url){                global $bdd;                if(empty($url)) return NULL;                $sql = "SELECT id_proj AS id FROM projects WHERE shortener = ".$url." LIMIT 1";        $q = $bdd->query($sql);        $p = $q->fetchObject();        if(!empty($p->id)) return Project::get($p->id);        else return NULL;            }public static function getDetail($id){                global $bdd, $INTERFACE;                if(!is_numeric($id)) return NULL;                $sql = "SELECT id_detail AS id, title, description, image FROM projects_details WHERE id_detail = ".$id;        $q = $bdd->query($sql);        $proj = $q->fetchObject();                $proj->title= stripslashes($proj->title);        $proj->description= stripslashes($proj->description);$proj->image_url= ('ADMIN'==$INTERFACE ? '../':'').'uploads/projects/'.$proj->image;                return $proj;            }                public static function add($data){                global $bdd;                $title      = trim($data['title']);        $website   = trim($data['website']);        $desc= $data['desc'];$img= trim($data['image']);                if(empty($title) || empty($desc)) return NULL;                $shortener = create_url($title);                $sql = "INSERT INTO projects(title, shortener, website, description, image, date_add) VALUES(".$bdd->quote($title).", ".$bdd->quote($shortener).", ".$bdd->quote($website).", ".$bdd->quote($desc).",  ".$bdd->quote($img).", '".date('Y-m-d')."')";        $bdd->query($sql);                $id = $bdd->lastInsertId();                if(is_numeric($id)) return $id;        else return NULL;            }public static function addDetail($data){                global $bdd;                $title      = trim($data['title']);        $desc= $data['desc'];$img= trim($data['image']);                if(empty($title) || empty($desc) || !isset($data['id_project']) || !is_numeric($data['id_project'])) return NULL;                $sql = "INSERT INTO projects_details(id_project, title, description, image) VALUES(".$data['id_project'].", ".$bdd->quote($title).", ".$bdd->quote($desc).",  ".$bdd->quote($img).")";        $bdd->query($sql);                $id = $bdd->lastInsertId();                if(is_numeric($id)) return $id;        else return NULL;            }                public static function update($data){                global $bdd;                $id         = $data['id_project'];        $title      = trim($data['title']);        $website   = trim($data['website']);        $desc= $data['desc'];$img= trim($data['image']);                if(empty($title) || empty($desc)) return NULL;                        $infos  = Project::get($id);                $sql = "UPDATE projects SET title = ".$bdd->quote($title).", website = ".$bdd->quote($website).", description = ".$bdd->quote($desc).", image = ".$bdd->quote($img)." WHERE id_project = ".$id;        $bdd->query($sql);        if($infos->image != $img){            @unlink(UPLOADS.'projects/'.$infos->image);        }                return $id;            }public static function updateDetail($data){                global $bdd;                $id         = $data['id_detail'];        $title      = trim($data['title']);        $desc= $data['desc'];$img= trim($data['image']);                if(empty($title) || empty($desc)) return NULL;                        $infos  = Project::getDetail($id);                $sql = "UPDATE projects_details SET title = ".$bdd->quote($title).", description = ".$bdd->quote($desc).", image = ".$bdd->quote($img)." WHERE id_detail = ".$id;        $bdd->query($sql);        if($infos->image != $img){            @unlink(UPLOADS.'projects/'.$infos->image);        }                return $id;            }                public static function remove($id_proj){                global $bdd;                if(!is_numeric($id_proj)) return NULL;                        $infos  = Project::get($id_proj);                $sql = "DELETE FROM projects WHERE id_project = ".$bdd->quote($id_proj);        $bdd->query($sql);        if(''!=$infos->image){            @unlink(UPLOADS.'projects/'.$infos->image);        }        return true;            }public static function removeDetail($id){                global $bdd;                if(!is_numeric($id)) return NULL;                        $infos  = Project::getDetail($id);                $sql = "DELETE FROM projects_details WHERE id_detail = ".$bdd->quote($id);        $bdd->query($sql);        if(''!=$infos->image){            @unlink(UPLOADS.'projects/'.$infos->image);        }        return true;            }            }?>